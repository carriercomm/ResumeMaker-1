(function(n){typeof define=="function"&&define.amd?define(["jquery","lodash"],n):n(jQuery,_)})(function(n,t){var f=window,u={is_intercepted:function(n,t){return!(n.x+n.width<=t.x||t.x+t.width<=n.x||n.y+n.height<=t.y||t.y+t.height<=n.y)},sort:function(n,i,r){return r=r||t.chain(n).map(function(n){return n.x+n.width}).max().value(),i=i!=-1?1:-1,t.sortBy(n,function(n){return i*(n.x+n.y*r)})},create_stylesheet:function(n){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.setAttribute("data-gs-id",n),t.styleSheet?t.styleSheet.cssText="":t.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(t),t.sheet},insert_css_rule:function(n,t,i,r){typeof n.insertRule=="function"?n.insertRule(t+"{"+i+"}",r):typeof n.addRule=="function"&&n.addRule(t,i,r)},toBool:function(n){return typeof n=="boolean"?n:typeof n=="string"?(n=n.toLowerCase(),!(n==""||n=="no"||n=="false"||n=="0")):Boolean(n)}},e=0,r=function(n,t,i,r,u){this.width=n;this.float=i||!1;this.height=r||0;this.nodes=u||[];this.onchange=t||function(){};this._update_counter=0;this._float=this.float},i;return r.prototype.batch_update=function(){this._update_counter=1;this.float=!0},r.prototype.commit=function(){this._update_counter=0;this._update_counter==0&&(this.float=this._float,this._pack_nodes(),this._notify())},r.prototype._fix_collisions=function(n){var r,f,i;for(this._sort_nodes(-1),r=n,f=Boolean(t.find(this.nodes,function(n){return n.locked})),this.float||f||(r={x:0,y:n.y,width:this.width,height:n.height});;){if(i=t.find(this.nodes,function(t){return t!=n&&u.is_intercepted(t,r)},this),typeof i=="undefined")return;this.move_node(i,i.x,n.y+n.height,i.width,i.height,!0)}},r.prototype.is_area_empty=function(n,i,r,f){var e={x:n||0,y:i||0,width:r||1,height:f||1},o=t.find(this.nodes,function(n){return u.is_intercepted(n,e)},this);return o==null},r.prototype._sort_nodes=function(n){this.nodes=u.sort(this.nodes,n,this.width)},r.prototype._pack_nodes=function(){this._sort_nodes();this.float?t.each(this.nodes,function(n){var i,r;if(!n._updating&&typeof n._orig_y!="undefined"&&n.y!=n._orig_y)for(i=n.y;i>=n._orig_y;)r=t.chain(this.nodes).find(function(t){return n!=t&&u.is_intercepted({x:n.x,y:i,width:n.width,height:n.height},t)}).value(),r||(n._dirty=!0,n.y=i),--i},this):t.each(this.nodes,function(n,i){var r,f,e;if(!n.locked)while(n.y>0){if(r=n.y-1,f=i==0,i>0&&(e=t.chain(this.nodes).take(i).find(function(t){return u.is_intercepted({x:n.x,y:r,width:n.width,height:n.height},t)}).value(),f=typeof e=="undefined"),!f)break;n._dirty=n.y!=r;n.y=r}},this)},r.prototype._prepare_node=function(n,i){return n=t.defaults(n||{},{width:1,height:1,x:0,y:0}),n.x=parseInt(""+n.x),n.y=parseInt(""+n.y),n.width=parseInt(""+n.width),n.height=parseInt(""+n.height),n.auto_position=n.auto_position||!1,n.no_resize=n.no_resize||!1,n.no_move=n.no_move||!1,n.width>this.width?n.width=this.width:n.width<1&&(n.width=1),n.height<1&&(n.height=1),n.x<0&&(n.x=0),n.x+n.width>this.width&&(i?n.width=this.width-n.x:n.x=this.width-n.width),n.y<0&&(n.y=0),n},r.prototype._notify=function(){if(!this._update_counter){var n=Array.prototype.slice.call(arguments,1).concat(this.get_dirty_nodes());n=n.concat(this.get_dirty_nodes());this.onchange(n)}},r.prototype.clean_nodes=function(){t.each(this.nodes,function(n){n._dirty=!1})},r.prototype.get_dirty_nodes=function(){return t.filter(this.nodes,function(n){return n._dirty})},r.prototype.add_node=function(n){var i,r,f;if(n=this._prepare_node(n),typeof n.max_width!="undefined"&&(n.width=Math.min(n.width,n.max_width)),typeof n.max_height!="undefined"&&(n.height=Math.min(n.height,n.max_height)),typeof n.min_width!="undefined"&&(n.width=Math.max(n.width,n.min_width)),typeof n.min_height!="undefined"&&(n.height=Math.max(n.height,n.min_height)),n._id=++e,n._dirty=!0,n.auto_position)for(this._sort_nodes(),i=0;;++i)if((r=i%this.width,f=Math.floor(i/this.width),!(r+n.width>this.width))&&!t.find(this.nodes,function(t){return u.is_intercepted({x:r,y:f,width:n.width,height:n.height},t)})){n.x=r;n.y=f;break}return this.nodes.push(n),this._fix_collisions(n),this._pack_nodes(),this._notify(),n},r.prototype.remove_node=function(n){n._id=null;this.nodes=t.without(this.nodes,n);this._pack_nodes();this._notify(n)},r.prototype.can_move_node=function(i,u,f,e,o){var l=Boolean(t.find(this.nodes,function(n){return n.locked})),s,h,c;return!this.height&&!l?!0:(h=new r(this.width,null,this.float,0,t.map(this.nodes,function(t){return t==i?s=n.extend({},t):n.extend({},t)})),h.move_node(s,u,f,e,o),c=!0,l&&(c&=!Boolean(t.find(h.nodes,function(n){return n!=s&&Boolean(n.locked)&&Boolean(n._dirty)}))),this.height&&(c&=h.get_grid_height()<=this.height),c)},r.prototype.can_be_placed_with_respect_to_height=function(i){if(!this.height)return!0;var u=new r(this.width,null,this.float,0,t.map(this.nodes,function(t){return n.extend({},t)}));return u.add_node(i),u.get_grid_height()<=this.height},r.prototype.move_node=function(n,t,i,r,u,f){if(typeof t!="number"&&(t=n.x),typeof i!="number"&&(i=n.y),typeof r!="number"&&(r=n.width),typeof u!="number"&&(u=n.height),typeof n.max_width!="undefined"&&(r=Math.min(r,n.max_width)),typeof n.max_height!="undefined"&&(u=Math.min(u,n.max_height)),typeof n.min_width!="undefined"&&(r=Math.max(r,n.min_width)),typeof n.min_height!="undefined"&&(u=Math.max(u,n.min_height)),n.x==t&&n.y==i&&n.width==r&&n.height==u)return n;var e=n.width!=r;return n._dirty=!0,n.x=t,n.y=i,n.width=r,n.height=u,n=this._prepare_node(n,e),this._fix_collisions(n),f||(this._pack_nodes(),this._notify()),n},r.prototype.get_grid_height=function(){return t.reduce(this.nodes,function(n,t){return Math.max(n,t.y+t.height)},0)},r.prototype.begin_update=function(n){t.each(this.nodes,function(n){n._orig_y=n.y});n._updating=!0},r.prototype.end_update=function(){t.each(this.nodes,function(n){n._orig_y=n.y});var n=t.find(this.nodes,function(n){return n._updating});n&&(n._updating=!1)},i=function(i,u){var f=this,e,o,s,h;this.container=n(i);u.item_class=u.item_class||"grid-stack-item";o=this.container.closest("."+u.item_class).size()>0;this.opts=t.defaults(u||{},{width:parseInt(this.container.attr("data-gs-width"))||12,height:parseInt(this.container.attr("data-gs-height"))||0,item_class:"grid-stack-item",placeholder_class:"grid-stack-placeholder",handle:".grid-stack-item-content",cell_height:60,vertical_margin:20,auto:!0,min_width:768,float:!1,_class:"grid-stack-"+(Math.random()*1e4).toFixed(0),animate:Boolean(this.container.attr("data-gs-animate"))||!1,always_show_resize_handle:u.always_show_resize_handle||!1,resizable:t.defaults(u.resizable||{},{autoHide:!(u.always_show_resize_handle||!1),handles:"se"}),draggable:t.defaults(u.draggable||{},{handle:".grid-stack-item-content",scroll:!1,appendTo:"body"})});this.opts.is_nested=o;this.container.addClass(this.opts._class);o&&this.container.addClass("grid-stack-nested");this._init_styles();this.grid=new r(this.opts.width,function(n){var i=0;t.each(n,function(n){n._id==null?n.el.remove():(n.el.attr("data-gs-x",n.x).attr("data-gs-y",n.y).attr("data-gs-width",n.width).attr("data-gs-height",n.height),i=Math.max(i,n.y+n.height))});f._update_styles(i+10)},this.opts.float,this.opts.height);this.opts.auto&&(s=[],this.container.children("."+this.opts.item_class).each(function(t,i){i=n(i);s.push({el:i,i:parseInt(i.attr("data-gs-x"))+parseInt(i.attr("data-gs-y"))*parseInt(i.attr("data-gs-width"))})}),t.chain(s).sortBy(function(n){return n.i}).each(function(n){f._prepare_element(n.el)}).value());this.set_animation(this.opts.animate);this.placeholder=n('<div class="'+this.opts.placeholder_class+" "+this.opts.item_class+'"><div class="placeholder-content" /><\/div>').hide();this.container.append(this.placeholder);this.container.height(this.grid.get_grid_height()*(this.opts.cell_height+this.opts.vertical_margin)-this.opts.vertical_margin);h=function(){if(f._is_one_column_mode()){if(e)return;e=!0;f.grid._sort_nodes();t.each(f.grid.nodes,function(n){f.container.append(n.el);n.no_move||n.el.draggable("disable");n.no_resize||n.el.resizable("disable")})}else{if(!e)return;e=!1;t.each(f.grid.nodes,function(n){n.no_move||n.el.draggable("enable");n.no_resize||n.el.resizable("enable")})}};n(window).resize(h);h()},i.prototype._init_styles=function(){this._styles_id&&n('[data-gs-id="'+this._styles_id+'"]').remove();this._styles_id="gridstack-style-"+(Math.random()*1e5).toFixed();this._styles=u.create_stylesheet(this._styles_id);this._styles!=null&&(this._styles._max=0)},i.prototype._update_styles=function(n){var i,t;if(this._styles!=null&&(i="."+this.opts._class+" ."+this.opts.item_class,typeof n=="undefined"&&(n=this._styles._max,this._init_styles(),this._update_container_height()),this._styles._max==0&&u.insert_css_rule(this._styles,i,"min-height: "+this.opts.cell_height+"px;",0),n>this._styles._max)){for(t=this._styles._max;t<n;++t)u.insert_css_rule(this._styles,i+'[data-gs-height="'+(t+1)+'"]',"height: "+(this.opts.cell_height*(t+1)+this.opts.vertical_margin*t)+"px;",t),u.insert_css_rule(this._styles,i+'[data-gs-min-height="'+(t+1)+'"]',"min-height: "+(this.opts.cell_height*(t+1)+this.opts.vertical_margin*t)+"px;",t),u.insert_css_rule(this._styles,i+'[data-gs-max-height="'+(t+1)+'"]',"max-height: "+(this.opts.cell_height*(t+1)+this.opts.vertical_margin*t)+"px;",t),u.insert_css_rule(this._styles,i+'[data-gs-y="'+t+'"]',"top: "+(this.opts.cell_height*t+this.opts.vertical_margin*t)+"px;",t);this._styles._max=n}},i.prototype._update_container_height=function(){this.grid._update_counter||this.container.height(this.grid.get_grid_height()*(this.opts.cell_height+this.opts.vertical_margin)-this.opts.vertical_margin)},i.prototype._is_one_column_mode=function(){return n(window).width()<=this.opts.min_width},i.prototype._prepare_element=function(i){var r=this,f,o,e,s,h;i=n(i);i.addClass(this.opts.item_class);f=r.grid.add_node({x:i.attr("data-gs-x"),y:i.attr("data-gs-y"),width:i.attr("data-gs-width"),height:i.attr("data-gs-height"),max_width:i.attr("data-gs-max-width"),min_width:i.attr("data-gs-min-width"),max_height:i.attr("data-gs-max-height"),min_height:i.attr("data-gs-min-height"),auto_position:u.toBool(i.attr("data-gs-auto-position")),no_resize:u.toBool(i.attr("data-gs-no-resize")),no_move:u.toBool(i.attr("data-gs-no-move")),locked:u.toBool(i.attr("data-gs-locked")),el:i});i.data("_gridstack_node",f);s=function(){var t=n(this);r.grid.clean_nodes();r.grid.begin_update(f);o=Math.ceil(t.outerWidth()/t.attr("data-gs-width"));e=r.opts.cell_height+r.opts.vertical_margin;r.placeholder.attr("data-gs-x",t.attr("data-gs-x")).attr("data-gs-y",t.attr("data-gs-y")).attr("data-gs-width",t.attr("data-gs-width")).attr("data-gs-height",t.attr("data-gs-height")).show();f.el=r.placeholder};h=function(){var t=n(this);f.el=t;r.placeholder.hide();t.attr("data-gs-x",f.x).attr("data-gs-y",f.y).attr("data-gs-width",f.width).attr("data-gs-height",f.height).removeAttr("style");r._update_container_height();r.container.trigger("change",[r.grid.get_dirty_nodes()]);r.grid.end_update()};i.draggable(t.extend(this.opts.draggable,{start:s,stop:h,drag:function(n,t){var i=Math.round(t.position.left/o),u=Math.floor((t.position.top+e/2)/e);r.grid.can_move_node(f,i,u,f.width,f.height)&&(r.grid.move_node(f,i,u),r._update_container_height())},containment:this.opts.is_nested?this.container.parent():null})).resizable(t.extend(this.opts.resizable,{start:s,stop:h,resize:function(n,t){var i=Math.round(t.position.left/o),u=Math.floor((t.position.top+e/2)/e),s=Math.round(t.size.width/o),h=Math.round(t.size.height/e);r.grid.can_move_node(f,i,u,s,h)&&(r.grid.move_node(f,i,u,s,h),r._update_container_height())}}));(f.no_move||this._is_one_column_mode())&&i.draggable("disable");(f.no_resize||this._is_one_column_mode())&&i.resizable("disable");i.attr("data-gs-locked",f.locked?"yes":null)},i.prototype.set_animation=function(n){n?this.container.addClass("grid-stack-animate"):this.container.removeClass("grid-stack-animate")},i.prototype.add_widget=function(t,i,r,u,f,e){return t=n(t),typeof i!="undefined"&&t.attr("data-gs-x",i),typeof r!="undefined"&&t.attr("data-gs-y",r),typeof u!="undefined"&&t.attr("data-gs-width",u),typeof f!="undefined"&&t.attr("data-gs-height",f),typeof e!="undefined"&&t.attr("data-gs-auto-position",e?"yes":null),this.container.append(t),this._prepare_element(t),this._update_container_height(),t},i.prototype.will_it_fit=function(n,t,i,r,u){var f={x:n,y:t,width:i,height:r,auto_position:u};return this.grid.can_be_placed_with_respect_to_height(f)},i.prototype.remove_widget=function(n,t){t=typeof t=="undefined"?!0:t;var i=n.data("_gridstack_node");this.grid.remove_node(i);n.removeData("_gridstack_node");this._update_container_height();t&&n.remove()},i.prototype.remove_all=function(n){t.each(this.grid.nodes,function(t){this.remove_widget(t.el,n)},this);this.grid.nodes=[];this._update_container_height()},i.prototype.resizable=function(t,i){return t=n(t),t.each(function(t,r){r=n(r);var u=r.data("_gridstack_node");typeof u!="undefined"&&u!=null&&(u.no_resize=!(i||!1),u.no_resize?r.resizable("disable"):r.resizable("enable"))}),this},i.prototype.movable=function(t,i){return t=n(t),t.each(function(t,r){r=n(r);var u=r.data("_gridstack_node");typeof u!="undefined"&&u!=null&&(u.no_move=!(i||!1),u.no_move?r.draggable("disable"):r.draggable("enable"))}),this},i.prototype.disable=function(){this.movable(this.container.children("."+this.opts.item_class),!1);this.resizable(this.container.children("."+this.opts.item_class),!1)},i.prototype.enable=function(){this.movable(this.container.children("."+this.opts.item_class),!0);this.resizable(this.container.children("."+this.opts.item_class),!0)},i.prototype.locked=function(t,i){return t=n(t),t.each(function(t,r){r=n(r);var u=r.data("_gridstack_node");typeof u!="undefined"&&u!=null&&(u.locked=i||!1,r.attr("data-gs-locked",u.locked?"yes":null))}),this},i.prototype._update_element=function(t,i){var u,r;(t=n(t).first(),u=t.data("_gridstack_node"),typeof u!="undefined"&&u!=null)&&(r=this,r.grid.clean_nodes(),r.grid.begin_update(u),i.call(this,t,u),r._update_container_height(),r.container.trigger("change",[r.grid.get_dirty_nodes()]),r.grid.end_update())},i.prototype.resize=function(n,t,i){this._update_element(n,function(n,r){t=t!=null&&typeof t!="undefined"?t:r.width;i=i!=null&&typeof i!="undefined"?i:r.height;this.grid.move_node(r,r.x,r.y,t,i)})},i.prototype.move=function(n,t,i){this._update_element(n,function(n,r){t=t!=null&&typeof t!="undefined"?t:r.x;i=i!=null&&typeof i!="undefined"?i:r.y;this.grid.move_node(r,t,i,r.width,r.height)})},i.prototype.update=function(n,t,i,r,u){this._update_element(n,function(n,f){t=t!=null&&typeof t!="undefined"?t:f.x;i=i!=null&&typeof i!="undefined"?i:f.y;r=r!=null&&typeof r!="undefined"?r:f.width;u=u!=null&&typeof u!="undefined"?u:f.height;this.grid.move_node(f,t,i,r,u)})},i.prototype.cell_height=function(n){if(typeof n=="undefined")return this.opts.cell_height;(n=parseInt(n),n!=this.opts.cell_height)&&(this.opts.cell_height=n||this.opts.cell_height,this._update_styles())},i.prototype.cell_width=function(){var n=this.container.children("."+this.opts.item_class).first();return Math.ceil(n.outerWidth()/n.attr("data-gs-width"))},i.prototype.get_cell_from_pixel=function(n){var t=this.container.position(),i=n.left-t.left,r=n.top-t.top,u=Math.floor(this.container.width()/this.opts.width),f=this.opts.cell_height+this.opts.vertical_margin;return{x:Math.floor(i/u),y:Math.floor(r/f)}},i.prototype.batch_update=function(){this.grid.batch_update()},i.prototype.commit=function(){this.grid.commit();this._update_container_height()},i.prototype.is_area_empty=function(n,t,i,r){return this.grid.is_area_empty(n,t,i,r)},f.GridStackUI=i,f.GridStackUI.Utils=u,n.fn.gridstack=function(t){return this.each(function(){n(this).data("gridstack")||n(this).data("gridstack",new i(this,t))})},f.GridStackUI});
//# sourceMappingURL=gridstack.min.js.map
